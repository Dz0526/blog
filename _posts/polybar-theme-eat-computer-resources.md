---
title: 'PolybarのテーマがPCのリソースをパクパク食べていた話'
date: '2022-04-24'
---

半年前くらい前に発表する予定だったが、機会がなくなったので供養のために…

# あるとき、ふと CPU 使用率を見ると…

普段は 1%くらいの CPU 使用率が 50%ほどあった。その時は何もしておらずターミナルを開いていただけだった。

# 当時の環境

PC : CPU は新しめでそれなりのスペック
OS : Linux. ずっと使っていたが、このようなことは一度もなかった

# top を実行

top コマンドは CPU 使用率が高いプロセス順に表示してくれる

systemd がほとんどをしめていたが、具体的なサービスまでは分からなかった

# systemd cgtop を実行

user.slice が一番上に！user.slice って何だ？

# user.slice とは

- slice は systemd が管理するユニットの一つ
- サービスなどのユニットを階層的に編成している。（プロセスをいい感じにまとめている？）
  <br>

つまり user.slice はユーザが実行しているプロセスを編成しているので、user が実行しているプログラムやプロセスが CPU 使用率高騰の原因か

# systemctl status user.slice を実行

たくさんのプロセスの中で見覚えのない shell script が実行されている

```
sh /*.sh
```

# 怪しいシェルスクリプトを発見

実行されているファイルを見ると Polybar テーマ配下にある様子…

天気予報だとか、中国語の名言を取得するようなスクリプトがたくさんあり、
それを実行し続ける内容だった。

使っていない機能もあったのでモジュールを使わないようにすると…

# 解決

無事に元の CPU 使用率に戻りました！

みなさんも OSS のテーマを適当に拾ってくるときは注意してください =-)
